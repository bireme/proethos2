{% extends "::base.html.twig" %}

{% block title %}{% trans %}New submission{% endtrans %}{% endblock %}

{% block content %}
    <div class="container-fluid main-content">
        <div class="row">
            <div class='col-md-12'>
                <h1 class="page-header">{% trans %}New submission{% endtrans %}</h1>
            </div>
        </div>

        {% include 'Proethos2CoreBundle:NewSubmission:meta.html.twig' %}

        <div class='new-submission-tab-content'>
            <form class='form' method='POST' id='form-third' action='{{ path("submission_new_third_step", {submission_id: submission.id}) }}' novalidate>

                <input type="hidden" name="token" value="{{ csrf_token('submission-third-step') }}"/>
                <input type='hidden' name='submission_id' value='{{ submission.id }}'>

                <div class='block'>
                    <div class='row'>
                        <div class="col-md-12">
                            <h2 class='sub-header'>{% trans %}General description{% endtrans %}</h2>
                        </div>
                    </div>

                    <div id="anchor-textarea-study-design"></div>

                    <div class='row'>
                        <div class="col-md-12">
                            <div class="form-group required">
                                <label for="textarea-study-design">{% trans %}Study design{% endtrans %}</label>
                                <a href="{{ path("crud_admin_help_show", {help_id: 17} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                <textarea rows="4" class="form-control summernote" name='study-design' id='textarea-study-design'>{{ submission.studyDesign }}</textarea>
                            </div>
                        </div>
                    </div>

                    <div class='row'>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="textarea-health-condition">{% trans %}Health Condition or Problem Studied{% endtrans %}</label>
                                <a href="{{ path("crud_admin_help_show", {help_id: 18} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                <textarea rows="4" class="form-control summernote" name='health-condition' id='textarea-health-condition'>{{ submission.healthCondition }}</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class='block'>
                    <div class='row'>
                        <div class="col-md-12">
                            <h2 class='sub-header'>{% trans %}Activities{% endtrans %}</h2>
                        </div>
                    </div>

                    <fieldset>
                        <div class="form-group required">
                            <label for="">{% trans %}More than one activity{% endtrans %}?</label>
                            <div class="radio">
                                {% if is_multiple_clinical_study %}
                                    <label><input type="radio" name="is_multiple_clinical_study" id="radio_multiple_clinical_study_yes" value="yes" {% if 'yes' == is_multiple_clinical_study %}checked{% endif %}> {% trans %}Yes{% endtrans %}</label>
                                    <label><input type="radio" name="is_multiple_clinical_study" id="radio_multiple_clinical_study_no" value="no" {% if 'no' == is_multiple_clinical_study %}checked{% endif %}> {% trans %}No{% endtrans %}</label>
                                {% else %}
                                    <label><input type="radio" name="is_multiple_clinical_study" id="radio_multiple_clinical_study_yes" value="yes" {% if submission.isMultipleClinicalStudy %}checked{% endif %}> {% trans %}Yes{% endtrans %}</label>
                                    <label><input type="radio" name="is_multiple_clinical_study" id="radio_multiple_clinical_study_no" value="no" {% if not submission.isMultipleClinicalStudy %}checked{% endif %}> {% trans %}No{% endtrans %}</label>
                                {% endif %}
                            </div>
                        </div>
                    </fieldset>
                </div>

                {% if is_multiple_clinical_study %}
                <div id="default-clinical-study" class='block' {% if 'yes' == is_multiple_clinical_study %}style="display: none;"{% endif %}>
                {% else %}
                <div id="default-clinical-study" class='block' {% if submission.isMultipleClinicalStudy %}style="display: none;"{% endif %}>
                {% endif %}
                    {% if not submission.isTranslation %}
                        <div class='row'>
                            <div class="col-md-3">
                                <div class="form-group required">
                                    <label for="select-gender">{% trans %}Gender{% endtrans %}:</label>
                                    <a href="{{ path("crud_admin_help_show", {help_id: 19} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                    <select class='form-control' id='select-gender' name='gender' {% if not submission.isMultipleClinicalStudy %}required{% endif %}>
                                        <option value="">-</option>
                                        {% for gender in genders %}
                                            <option value="{{ gender.id }}" {% if submission.gender == gender %}selected{% endif %}>{{ gender.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="form-group required">
                                    <label for="input-sample-size">{% trans %}Target sample size{% endtrans %}:</label>
                                    <a href="{{ path("crud_admin_help_show", {help_id: 20} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                    <input type="number" class="form-control" placeholder="" min="0" value="{{ submission.sampleSize }}" id='input-sample-size' name='sample-size' {% if not submission.isMultipleClinicalStudy %}required{% endif %}>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="form-group required">
                                    <label for="input-minimum-age">{% trans %}Minimum Age{% endtrans %}:</label>
                                    <a href="{{ path("crud_admin_help_show", {help_id: 21} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                    <input type="number" class="form-control" placeholder="" min="0" value="{{ submission.minimumAge }}" name='minimum-age' id='input-minimum-age' {% if not submission.isMultipleClinicalStudy %}required{% endif %}>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="form-group required">
                                    <label for="input-maximum-age">{% trans %}Maximum Age{% endtrans %}:</label>
                                    <a href="{{ path("crud_admin_help_show", {help_id: 22} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                    <input type="number" class="form-control" placeholder="" min="0" value="{{ submission.maximumAge }}" name='maximum-age' id='input-maximum-age' {% if not submission.isMultipleClinicalStudy %}required{% endif %}>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <div class='row'>
                        <div class="col-md-12">
                            <div class="form-group required">
                                <label for="textarea-sample-size-justify">{% trans %}Justify sample size{% endtrans %}:</label>
                                <a href="{{ path("crud_admin_help_show", {help_id: 225} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                <textarea rows="5" class="form-control summernote" id='textarea-sample-size-justify' name='sample-size-justify' {% if not submission.isMultipleClinicalStudy %}required{% endif %}>{{ submission.sampleSizeJustify }}</textarea>
                            </div>
                        </div>
                    </div>

                    <div class='row'>
                        <div class="col-md-12">
                            <div class="form-group required">
                                <label for="textarea-inclusion-criteria">{% trans %}Inclusion criteria{% endtrans %}:</label>
                                <a href="{{ path("crud_admin_help_show", {help_id: 23} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                <textarea rows="5" class="form-control summernote" id='textarea-inclusion-criteria' name='inclusion-criteria' {% if not submission.isMultipleClinicalStudy %}required{% endif %}>{{ submission.inclusionCriteria }}</textarea>
                            </div>
                        </div>
                    </div>

                    <div class='row'>
                        <div class="col-md-12">
                            <div class="form-group required">
                                <label for="textarea-exclusion-criteria">{% trans %}Exclusion criteria{% endtrans %}:</label>
                                <a href="{{ path("crud_admin_help_show", {help_id: 24} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                <textarea rows="5" class="form-control summernote" id='textarea-exclusion-criteria' name='exclusion-criteria' {% if not submission.isMultipleClinicalStudy %}required{% endif %}>{{ submission.exclusionCriteria }}</textarea>
                            </div>
                        </div>
                    </div>

                    {% if not submission.isTranslation %}
                        <div class='row'>
                            <div class="col-md-12">
                                <div class="form-group required">
                                    <label for="input-recruitment-init-date">{% trans %}Estimated date of initial recruitment{% endtrans %}:</label>
                                    <a href="{{ path("crud_admin_help_show", {help_id: 25} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                    <input type="text" class='form-control datepicker' id='input-recruitment-init-date' name='recruitment-init-date' value='{{ submission.recruitmentInitDate|date("Y-m-d") }}' {% if not submission.isMultipleClinicalStudy %}required{% endif %}>
                                </div>
                            </div>
                        </div>

                        <div class='row'>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="select-recruitment-status">{% trans %}Recruitment Status{% endtrans %}:</label>
                                    <a href="{{ path("crud_admin_help_show", {help_id: 26} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                    <select class='form-control' id='select-recruitment-status' name='recruitment-status'>
                                        <option value="">-</option>
                                        {% for status in recruitment_statuses %}
                                            <option value="{{ status.id }}" {% if status == submission.recruitmentStatus %}selected{% endif %}>{{ status.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>

                {% if is_multiple_clinical_study %}
                <div id="multiple-clinical-study" class='block' {% if 'no' == is_multiple_clinical_study %}style="display: none;"{% endif %}>
                {% else %}
                <div id="multiple-clinical-study" class='block' {% if not submission.isMultipleClinicalStudy %}style="display: none;"{% endif %}>
                {% endif %}
                    <div class='row'>
                        <div class="col-md-12">
                            <table class='table table-hover table-condensed'>
                                
                                <thead>
                                    <tr>
                                        <th>{% trans %}Gender{% endtrans %}</th>
                                        <th>{% trans %}Target sample size{% endtrans %}</th>
                                        <th>{% trans %}Minimum Age{% endtrans %}</th>
                                        <th>{% trans %}Maximum Age{% endtrans %}</th>
                                        <th>{% trans %}Estimated date of initial recruitment{% endtrans %}</th>
                                        <th>{% trans %}Recruitment Status{% endtrans %}</th>
                                        <th>{% trans %}Actions{% endtrans %}</th>
                                    </tr>
                                </thead>
                                
                                <tbody>
                                    {% for activity in submission_clinical_study %}
                                        <tr>
                                            <td data-label="{% trans %}Gender{% endtrans %}">{{ activity.gender.name }}</td> 
                                            <td data-label="{% trans %}Target sample size{% endtrans %}">{{ activity.sampleSize }}</td> 
                                            <td data-label="{% trans %}Minimum Age{% endtrans %}">{{ activity.minimumAge }}</td> 
                                            <td data-label="{% trans %}Maximum Age{% endtrans %}">{{ activity.maximumAge }}</td> 
                                            <td data-label="{% trans %}Estimated date of initial recruitment{% endtrans %}">{{ activity.recruitmentInitDate|date("Y-m-d") }}</td> 
                                            <td data-label="{% trans %}Recruitment Status{% endtrans %}">{{ activity.recruitmentStatus.name }}</td> 
                                            <td data-label="{% trans %}Actions{% endtrans %}">
                                                <a href='{{ path("submission_show_activity", {activity_id: activity.id} ) }}' data-toggle='modal' data-target='#modal-show-activity' class='btn btn-default btn-xs'><i class='glyphicon glyphicon-eye-open'></i></a>
                                                <a href='{{ path("submission_update_activity", {submission_id: submission.id, activity_id: activity.id} ) }}' data-toggle='modal' data-target='#modal-update-activity' class='btn btn-default btn-xs'><i class='glyphicon glyphicon-pencil'></i></a>
                                                <a href='{{ path("submission_delete_activity", {submission_id: submission.id, activity_id: activity.id} ) }}' data-toggle='modal' data-target='#modal-delete-activity' class='btn btn-danger btn-xs'><i class='glyphicon glyphicon-trash'></i></a>
                                            </td> 
                                        </tr>
                                    {% endfor %}
                                    
                                </tbody>
                            </table>
                            <a href='#' class='btn btn-default' data-toggle="modal" data-target="#modal-new-activity">{% trans %}New Activity{% endtrans %}</a>
                        </div>
                    </div>
                </div>

                <div class='block'>
                    <div class='row'>
                        <div class="col-md-12">
                            <h2 class='sub-header'>{% trans %}Recruitment Countries{% endtrans %}:</h2>
                        </div>
                    </div>

                    {% if not submission.isTranslation %}
                        <div class='row'>
                            <div class="col-md-12">
                                <table class='table table-hover table-condensed' id='table-country'>

                                    <thead>
                                        <tr>
                                            <th width="50%">{% trans %}Country{% endtrans %}</th>
                                            <th>{% trans %}Total of participants{% endtrans %}</th>
                                            <th>{% trans %}Actions{% endtrans %}</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        {% for country in submission.country %}
                                        <tr>
                                            <input type='hidden' name='country[{{ loop.index0 }}][country_id]' value='{{ country.country.id }}'>
                                            <input type='hidden' name='country[{{ loop.index0 }}][participants]' value='{{ country.participants }}'>

                                            <td data-label="{% trans %}Country{% endtrans %}">{{ country.country }}</td>
                                            <td data-label="{% trans %}Total of participants{% endtrans %}"><label class='label label-default'>{{ country.participants }}</label></td>
                                            <td data-label="{% trans %}Actions{% endtrans %}"><a href='#' class='btn btn-default btn-xs button-remove-country'><i class='glyphicon glyphicon-trash'></i></a></td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                                <a href='#' class='btn btn-default' data-toggle="modal" data-target="#modal-new-country">{% trans %}New Country{% endtrans %}</a>
                            </div>
                        </div>
                    {% endif %}

                    <div class='row submission-meta'></div>

                    <div id="anchor-textarea-interventions"></div>

                    <div class='row'>
                        <div class="col-md-12">
                            <div class="form-group required">
                                <label for="textarea-interventions">{% trans %}Interventions{% endtrans %}:</label>
                                <a href="{{ path("crud_admin_help_show", {help_id: 27} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                <textarea rows="4" class="form-control summernote" id='textarea-interventions' name='interventions'>{{ submission.interventions }}</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class='block'>
                    <div class='row'>
                        <div class="col-md-12">
                            <h2 class='sub-header'>{% trans %}Outcomes{% endtrans %}</h2>
                        </div>
                    </div>

                    <div id="anchor-textarea-primary-outcome"></div>

                    <div class='row'>
                        <div class="col-md-12">
                            <div class="form-group required">
                                <label for="textarea-primary-outcome">{% trans %}Primary outcomes{% endtrans %}</label>
                                <a href="{{ path("crud_admin_help_show", {help_id: 28} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                <textarea rows="4" class="form-control summernote" id='textarea-primary-outcome' name='primary-outcome'>{{ submission.primaryOutcome }}</textarea>
                            </div>
                        </div>
                    </div>

                    <div class='row'>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="textarea-secondary-outcome">{% trans %}Secondary outcomes{% endtrans %}</label>
                                <a href="{{ path("crud_admin_help_show", {help_id: 29} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                <textarea rows="4" class="form-control summernote" id='textarea-secondary-outcome' name='secondary-outcome'>{{ submission.secondaryOutcome }}</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class='block'>
                    <div class='row'>
                        <div class="col-md-12">
                            <h2 class='sub-header'>{% trans %}Methodology{% endtrans %}</h2>
                        </div>
                    </div>

                    <div class='row'>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="textarea-general-procedures">{% trans %}General Procedures{% endtrans %}:</label>
                                <a href="{{ path("crud_admin_help_show", {help_id: 30} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                <textarea rows="4" class="form-control summernote" id='textarea-general-procedures' name='general-procedures'>{{ submission.generalProcedures }}</textarea>
                            </div>
                        </div>
                    </div>

                    <div class='row'>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="textarea-analysis-plan">{% trans %}Analysis Plan{% endtrans %}:</label>
                                <a href="{{ path("crud_admin_help_show", {help_id: 31} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                <textarea rows="4" class="form-control summernote" id='textarea-analysis-plan' name='analysis-plan'>{{ submission.analysisPlan }}</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class='block'>
                    <div class='row'>
                        <div class="col-md-12">
                            <h2 class='sub-header'>{% trans %}Ethical Considerations{% endtrans %}:</h2>
                        </div>
                    </div>

                    <div class='row'>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="textarea-ethical-considerations">{% trans %}Ethical Considerations{% endtrans %}:</label>
                                <a href="{{ path("crud_admin_help_show", {help_id: 32} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                <textarea rows="4" class="form-control" id='textarea-ethical-considerations' name='ethical-considerations'>{{ submission.ethicalConsiderations }}</textarea>
                            </div>
                        </div>
                    </div>

                    <div class='row'>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="textarea-limitations">{% trans %}Limitations{% endtrans %}:</label>
                                <a href="{{ path("crud_admin_help_show", {help_id: 226} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                <textarea rows="4" class="form-control" id='textarea-limitations' name='limitations'>{{ submission.limitations }}</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class='submission-button-controls'>
                    <button type='submit' id="form-submission-submit" class='btn btn-primary'>{% trans %}Save and next{% endtrans %}</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Novo País -->
    <div class="modal fade" id="modal-new-country" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <form class='form' id='form-country'>
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">{% trans %}New Country{% endtrans %}</h4>
                    </div>
                    <div class="modal-body">

                        <div class="form-group">
                            <label for="">{% trans %}Country{% endtrans %}:</label>
                            <a href="{{ path("crud_admin_help_show", {help_id: 33} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                            <select class='form-control selectpicker' data-live-search="true" name='country' id='select-country-country'>
                                <option value="">{% trans %}Select country{% endtrans %}</option>
                                {% for country in countries %}
                                    <option value="{{ country.id }}">{{ country }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="">{% trans %}Participants{% endtrans %}:</label>
                            <a href="{{ path("crud_admin_help_show", {help_id: 34} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                            <input type='number' class='form-control' min="1" name='participants' id='input-country-participants'>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">{% trans %}Close{% endtrans %}</button>
                        <button type="button" id='submit-country-form' class="btn btn-primary" data-dismiss="modal">{% trans %}Save{% endtrans %}</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal New Activity -->
    <div class="modal fade" id="modal-new-activity" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <form class='form' method="POST" id='form-new-activity' novalidate>

                    <input type="hidden" name="token" value="{{ csrf_token('submission-third-step') }}"/>
                    <input type="hidden" id="new-activity" name="new-activity" value="true"/>
                    <input type="hidden" id="form-data" name="form-data" value=""/>                    

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel" style="display: inline;">{% trans %}New Activity{% endtrans %}</h4>
                        <a href="{{ path("crud_admin_help_show", {help_id: 220} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                    </div>
                    <div class="modal-body">

                        <div class='row'>
                            <div class="col-md-12">
                                <div class="form-group required">
                                    <label for="input-new-activity-description">{% trans %}Description{% endtrans %}:</label>
                                    <a href="{{ path("crud_admin_help_show", {help_id: 221} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                    <input type="text" class="form-control" name='activity-description' id='input-new-activity-description' value="{{ submission.description }}" required>
                                </div>
                            </div>
                        </div>
                        
                        {% if not submission.isTranslation %}
                            <div class='row'>
                                <div class="col-md-12">
                                    <div class="form-group required">
                                        <label for="select-new-activity-gender">{% trans %}Gender{% endtrans %}:</label>
                                        <a href="{{ path("crud_admin_help_show", {help_id: 19} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                        <select class='form-control' id='select-new-activity-gender' name='activity-gender' required>
                                            <option value="">-</option>
                                            {% for gender in genders %}
                                                <option value="{{ gender.id }}">{{ gender.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class='row'>
                                <div class="col-md-12">
                                    <div class="form-group required">
                                        <label for="input-new-activity-sample-size">{% trans %}Target sample size{% endtrans %}:</label>
                                        <a href="{{ path("crud_admin_help_show", {help_id: 20} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                        <input type="number" class="form-control" placeholder="" min="0" value="" id='input-new-activity-sample-size' name='activity-sample-size' required>
                                    </div>
                                </div>
                            </div>

                            <div class='row'>
                                <div class="col-md-12">
                                    <div class="form-group required">
                                        <label for="input-new-activity-minimum-age">{% trans %}Minimum Age{% endtrans %}:</label>
                                        <a href="{{ path("crud_admin_help_show", {help_id: 21} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                        <input type="number" class="form-control" placeholder="" min="0" value="" name='activity-minimum-age' id='input-new-activity-minimum-age' required>
                                    </div>
                                </div>
                            </div>

                            <div class='row'>
                                <div class="col-md-12">
                                    <div class="form-group required">
                                        <label for="input-new-activity-maximum-age">{% trans %}Maximum Age{% endtrans %}:</label>
                                        <a href="{{ path("crud_admin_help_show", {help_id: 22} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                        <input type="number" class="form-control" placeholder="" min="0" value="" name='activity-maximum-age' id='input-new-activity-maximum-age' required>
                                    </div>
                                </div>
                            </div>
                        {% endif %}

                        <div id="anchor-textarea-new-activity-sample-size-justify"></div>

                        <div class='row'>
                            <div class="col-md-12">
                                <div class="form-group required">
                                    <label for="textarea-new-activity-sample-size-justify">{% trans %}Justify sample size{% endtrans %}:</label>
                                    <a href="{{ path("crud_admin_help_show", {help_id: 225} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                    <textarea rows="5" class="form-control summernote" id='textarea-new-activity-sample-size-justify' name='activity-sample-size-justify' required></textarea>
                                </div>
                            </div>
                        </div>

                        <div id="anchor-textarea-new-activity-inclusion-criteria"></div>

                        <div class='row'>
                            <div class="col-md-12">
                                <div class="form-group required">
                                    <label for="textarea-new-activity-inclusion-criteria">{% trans %}Inclusion criteria{% endtrans %}:</label>
                                    <a href="{{ path("crud_admin_help_show", {help_id: 23} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                    <textarea rows="5" class="form-control summernote" id='textarea-new-activity-inclusion-criteria' name='activity-inclusion-criteria' required></textarea>
                                </div>
                            </div>
                        </div>

                        <div id="anchor-textarea-new-activity-exclusion-criteria"></div>

                        <div class='row'>
                            <div class="col-md-12">
                                <div class="form-group required">
                                    <label for="textarea-new-activity-exclusion-criteria">{% trans %}Exclusion criteria{% endtrans %}:</label>
                                    <a href="{{ path("crud_admin_help_show", {help_id: 24} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                    <textarea rows="5" class="form-control summernote" id='textarea-new-activity-exclusion-criteria' name='activity-exclusion-criteria' required></textarea>
                                </div>
                            </div>
                        </div>

                        {% if not submission.isTranslation %}
                            <div class='row'>
                                <div class="col-md-12">
                                    <div class="form-group required">
                                        <label for="input-new-activity-recruitment-init-date">{% trans %}Estimated date of initial recruitment{% endtrans %}:</label>
                                        <a href="{{ path("crud_admin_help_show", {help_id: 25} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                        <input type="text" class='form-control datepicker' id='input-new-activity-recruitment-init-date' name='activity-recruitment-init-date' value='' required>
                                    </div>
                                </div>
                            </div>

                            <div class='row'>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="select-activity-recruitment-status">{% trans %}Recruitment Status{% endtrans %}:</label>
                                        <a href="{{ path("crud_admin_help_show", {help_id: 26} ) }}" data-toggle="modal" data-target="#modal-help"><i class='glyphicon glyphicon-question-sign'></i></a>
                                        <select class='form-control' id='select-activity-recruitment-status' name='activity-recruitment-status'>
                                            <option value="">-</option>
                                            {% for status in recruitment_statuses %}
                                                <option value="{{ status.id }}" {% if status == submission.recruitmentStatus %}selected{% endif %}>{{ status.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        {% endif %}

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">{% trans %}Close{% endtrans %}</button>
                        <button type="submit" id="form-new-activity-submit" class="btn btn-primary">{% trans %}Save{% endtrans %}</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Show Activity -->
    <div class="modal fade" id="modal-show-activity" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content"></div>
        </div>
    </div>
    
    <!-- Modal Update Activity -->
    <div class="modal fade" id="modal-update-activity" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content"></div>
        </div>
    </div>

    <!-- Modal Delete Activity -->
    <div class="modal fade" id="modal-delete-activity" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content"></div>
        </div>
    </div>
{% endblock %}

{% block script %}
    <script>
        $(function(){

            $total_countries = {{ submission.country|length }};

            // modal country submit action
            $("#submit-country-form").click(function(e){
                e.preventDefault();

                $country = $("#select-country-country option:selected");
                $participants = $("#input-country-participants");

                string =  "<tr>"
                string +=    "<input type='hidden' name='country["+ $total_countries +"][country_id]' value='"+ $country.val() +"'>"
                string +=    "<input type='hidden' name='country["+ $total_countries +"][participants]' value='"+ $participants.val() +"'>"
                string +=    "<td>"+ $country.text() +"</td>"
                string +=    "<td><label class='label label-default'>"+ $participants.val() +"</label></td>"
                string +=    "<td><a href='#' class='btn btn-default btn-xs button-remove-country'><i class='glyphicon glyphicon-trash'></i></a></td>"
                string += "</tr>"

                $("#table-country tbody").append(string);
                $total_countries += 1;
            });

            // button trash action
            $("#table-country").on("click", ".button-remove-country", function(e){
                e.preventDefault();

                parent = $(this).parents('tr');
                parent.remove();
            });
        });

        $(function(){
            {% if not submission.isTranslation %}
                $("#form-submission-submit").on('click', function(e){
                    e.preventDefault();
                    
                    var radio =  $('input[name=is_multiple_clinical_study]:checked', '#form-third').val();
                    var today = new Date();
                    var recruitment_date = $("#form-third #input-recruitment-init-date").val();
                    recruitment_date = new Date(recruitment_date);

                    if ( radio == 'no' ) {
                        if(recruitment_date > today) {
                            $("#form-third").submit();
                        } else {
                            $("#form-third #input-recruitment-init-date").focus();
                            alert("{% trans %}ERROR. The initial recruitment date needs to be subsequent to today's date.{% endtrans %}");
                        }
                    } else {
                        $("#form-third").submit();
                    }
                });

                $("#form-new-activity-submit").on('click', function(e){
                    e.preventDefault();

                    var data = $('#form-third').serializeArray();
                    data = JSON.stringify(data);
                    $("#form-data").val(data);

                    var radio =  $('input[name=is_multiple_clinical_study]:checked', '#form-third').val();
                    var today = new Date();
                    var recruitment_date = $("#form-new-activity #input-new-activity-recruitment-init-date").val();
                    recruitment_date = new Date(recruitment_date);

                    if ( radio == 'yes' ) {
                        if(recruitment_date > today) {
                            $("#form-new-activity").submit();
                        } else {
                            $("#form-new-activity #input-new-activity-recruitment-init-date").focus();
                            alert("{% trans %}ERROR: The initial recruitment date needs to be subsequent to today's date.{% endtrans %}");
                        }
                    } else {
                        $("#form-new-activity").submit();
                    }
                });
            {% endif %}
        });

        // WYSIWYG fields
        $(function(){
            // $('#form-third .summernote').wysihtml5();
            $('#form-third .summernote').summernote({
                height: 150,
                dialogsInBody: true,
                lang: '{% if 'en' == app.request.locale %}en-US{% else %}{{ app.request.locale|replace({ '_': '-' }) }}{% endif %}',
                popover: {
                    image: [],
                    link: [],
                    air: []
                }
            });

            // $('#form-new-activity .summernote').wysihtml5(); 
            $('#form-new-activity .summernote').summernote({
                height: 150,
                dialogsInBody: true,
                lang: '{% if 'en' == app.request.locale %}en-US{% else %}{{ app.request.locale|replace({ '_': '-' }) }}{% endif %}',
                popover: {
                    image: [],
                    link: [],
                    air: []
                }
            });
        });

        $(function(){
            $('#form-third').on('submit', function(e) {
                var radio =  $('input[name=is_multiple_clinical_study]:checked', '#form-third').val();

                if ( $('#textarea-study-design').summernote('isEmpty') ) {
                    // cancel submit
                    e.preventDefault();
                    alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                    highlight_input_field('#textarea-study-design', 'sn');
                    return false;
                }

                if ( $('#textarea-interventions').summernote('isEmpty') ) {
                    // cancel submit
                    e.preventDefault();
                    alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                    highlight_input_field('#textarea-interventions', 'sn');
                    return false;
                }

                if ( radio == 'no' ) {
                    if ( !$('#select-gender').val() ) {
                        // cancel submit
                        e.preventDefault();
                        alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                        highlight_input_field('#select-gender');
                        return false;
                    }

                    if ( $('#input-sample-size').val() == 0 ) {
                        // cancel submit
                        e.preventDefault();
                        alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                        highlight_input_field('#input-sample-size');
                        return false;
                    }

                    if ( $('#input-minimum-age').val() == 0 ) {
                        // cancel submit
                        e.preventDefault();
                        alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                        highlight_input_field('#input-minimum-age');
                        return false;
                    }

                    if ( $('#input-maximum-age').val() == 0 ) {
                        // cancel submit
                        e.preventDefault();
                        alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                        highlight_input_field('#input-maximum-age');
                        return false;
                    }

                    if ( $('#textarea-sample-size-justify').summernote('isEmpty') ) {
                        // cancel submit
                        e.preventDefault();
                        alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                        highlight_input_field('#textarea-sample-size-justify', 'sn');
                        return false;
                    }

                    if ( $('#textarea-inclusion-criteria').summernote('isEmpty') ) {
                        // cancel submit
                        e.preventDefault();
                        alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                        highlight_input_field('#textarea-inclusion-criteria', 'sn');
                        return false;
                    }

                    if ( $('#textarea-exclusion-criteria').summernote('isEmpty') ) {
                        // cancel submit
                        e.preventDefault();
                        alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                        highlight_input_field('#textarea-exclusion-criteria', 'sn');
                        return false;
                    }
                }

                if ( $('#textarea-primary-outcome').summernote('isEmpty') ) {
                    // cancel submit
                    e.preventDefault();
                    alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                    highlight_input_field('#textarea-primary-outcome', 'sn');
                    return false;
                }
            });
        });

        $(function(){
            $('#form-new-activity').on('submit', function(e) {
                if ( !$('#input-new-activity-description').val() ) {
                    // cancel submit
                    e.preventDefault();
                    alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                    highlight_input_field('#input-new-activity-description');
                    return false;
                }

                if ( !$('#select-new-activity-gender').val() ) {
                    // cancel submit
                    e.preventDefault();
                    alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                    highlight_input_field('#select-new-activity-gender');
                    return false;
                }

                if ( $('#input-new-activity-sample-size').val() == 0 ) {
                    // cancel submit
                    e.preventDefault();
                    alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                    highlight_input_field('#input-new-activity-sample-size');
                    return false;
                }

                if ( $('#input-new-activity-minimum-age').val() == 0 ) {
                    // cancel submit
                    e.preventDefault();
                    alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                    highlight_input_field('#input-new-activity-minimum-age');
                    return false;
                }

                if ( $('#input-new-activity-maximum-age').val() == 0 ) {
                    // cancel submit
                    e.preventDefault();
                    alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                    highlight_input_field('#input-new-activity-maximum-age');
                    return false;
                }

                if ( $('#textarea-new-activity-sample-size-justify').summernote('isEmpty') ) {
                    // cancel submit
                    e.preventDefault();
                    alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                    highlight_input_field('#textarea-new-activity-sample-size-justify', 'sn');
                    return false;
                }

                if ( $('#textarea-new-activity-inclusion-criteria').summernote('isEmpty') ) {
                    // cancel submit
                    e.preventDefault();
                    alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                    highlight_input_field('#textarea-new-activity-inclusion-criteria', 'sn');
                    return false;
                }

                if ( $('#textarea-new-activity-exclusion-criteria').summernote('isEmpty') ) {
                    // cancel submit
                    e.preventDefault();
                    alert('{% trans %}Notice: Please complete all required fields.{% endtrans %}');
                    highlight_input_field('#textarea-new-activity-exclusion-criteria', 'sn');
                    return false;
                }
            });
        });
    </script>
{% endblock %}
